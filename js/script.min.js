let data={},charts={},gResults=[];const init=()=>{const t=["議案種類","提出回次","番号","議案件名","審議回次","審議状況","議案提出者"],e=["審議回次","審議状況","経過情報","経過情報URL","本文情報","本文情報URL","議案種類","議案提出者","衆議院予備審査議案受理年月日","衆議院予備付託年月日／衆議院予備付託委員会","衆議院議案受理年月日","衆議院付託年月日／衆議院付託委員会","衆議院審査終了年月日／衆議院審査結果","衆議院審議終了年月日／衆議院審議結果","衆議院審議時会派態度","衆議院審議時賛成会派","衆議院審議時反対会派","参議院予備審査議案受理年月日","参議院予備付託年月日／参議院予備付託委員会","参議院議案受理年月日","参議院付託年月日／参議院付託委員会","参議院審査終了年月日／参議院審査結果","参議院審議終了年月日／参議院審議結果","公布年月日／法律番号"],a=["ロシア","東日本大震災","新型コロナ","消費税","年金","エネルギー","学校","復興","ウイルス","銀行","郵政","脱税","アメリカ","土地","海上","図書館","関税","大学","子ども","憲法","高齢","漁業","東京","衛生","食品","建築","保育","電波","住宅","科学","証券","沖縄","家族","検察","農林","祝日","燃料","農地","土砂","輸出","スポーツ","国土","教職員","警備","預金","貯金","北海道","鉄道","青少年","インフルエンザ","消防","港湾","医薬","家畜","インド","オリンピック","畜産","患者","テロ","牛肉","鳥獣","衛星","インターネット","扶養","子育て","駐留","パラリンピック","種子"],n=[["自由民主党","立憲民主党","日本維新の会","公明党","国民民主党","日本共産党","れいわ新選組"],["民主党","社会民主党","自由党","希望の党","民進党","生活の党"]],i=t=>String(t).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,");(()=>{const t=()=>{const t=(t,e)=>{let a=Object.keys(t).map(e=>({key:e,value:t[e]}));a.sort((t,e)=>t.value-e.value),t=Object.assign({},...a.map(t=>({[t.key]:t.value}))),config_data=[],config_labels=[];for(let e in t)config_data.push(t[e]),config_labels.push(e);return{domid:e,labels:config_labels,datasets:[{name:"",data:config_data}]}},e=t=>{const e=$("#"+t.domid).find(".inner")[0];e.style.height=20+20*t.datasets[0].data.length+"px","summary-chart-foragainst"===t.domid&&(e.style.height=1.2*parseInt(e.style.height.replace("px",""))+"px");const a=echarts.init(e);let n={legend:{show:t.datasets.length>=2},grid:{top:t.datasets.length>=2?"40px":"0",left:"3%",right:"6%",bottom:"3%",containLabel:!0},tooltip:{show:!0,trigger:"axis",axisPointer:{type:"shadow"},alwaysShowContent:!0,className:"echarts-tooltip",backgroundColor:"rgba(0, 0, 0, 0.6)",borderWidth:0,padding:[8,16],textStyle:{color:"#fefefe",fontSize:13},formatter:e=>{let a=t.labels[e[0].dataIndex];"summary-chart-committee"===t.domid&&"審査会"!==a.substr(-3)&&"審査省略要求"!==a&&(a+="委員会"),i(e[0].value);let n=a;return e.map((a,s)=>{let l=""!==t.datasets[s].name?t.datasets[s].name+"：":"";if(n+="<br>"+l+"<span>"+i(a.value)+"</span> 件","summary-chart-foragainst"===t.domid){const t=e.reduce((t,e)=>t+e.value,0);n+="（"+(100*a.value/t).toFixed(1)+"％）"}}),n}},xAxis:{type:"value",position:"top",splitNumber:4,splitLine:{show:!0,lineStyle:{color:"#ccc"}},axisLabel:{formatter:t=>i(t)}},yAxis:{type:"category",data:t.labels.map(t=>{let e=t;return t.length>=8&&(e=t.slice(0,7)+"…"),e})},series:[]};t.datasets.map((e,a)=>{n.series.push({name:e.name,type:"bar",stack:"total",label:{show:1===t.datasets.length,position:"right",textBorderColor:"#fff",textBorderWidth:0,color:"#47a",formatter:t=>i(t.data)},itemStyle:{color:0===a?"#47a":"#f5d25f"},data:e.data})}),a.setOption(n)},s=(t,e)=>{const a=$("#"+e);for(let e in data[t]){const n='<option value="'+e+'">'+data[t][e]+"</option>";a.append(n)}},l=t=>{const e=$("#"+t);n.map((t,a)=>{const n=["現在の主な政党","過去の主な政党"][a];e.append('<optgroup label="'+n+'"></optgroup>'),t.map(t=>{const a='<option value="'+t+'">'+t+"</option>";e.find("optgroup:last").append(a)})})};s("gian_type","select-gian-type"),s("gian_status","select-gian-status"),l("select-party-for"),l("select-party-against"),(()=>{let a={};data.gian_summary.map(t=>{const e=t[5];""!==e&&(a[e]||(a[e]=0),a[e]+=1)}),e(t(a,"summary-chart-status"))})(),(()=>{let a={};data.gian_summary.map(t=>{t[7].map(t=>{const e=t[11];if(-1!==e.indexOf("／")){const t=e.split("／")[1];""!==t&&"審査省略"!==t&&(a[t]||(a[t]=0),a[t]+=1)}})}),e(t(a,"summary-chart-committee"))})(),(()=>{let a={};data.gian_summary.map(t=>{let e=t[6],n=0;-1!==e.indexOf("君外")&&(e=e.split("君外")[0].replace("　"," "),n=1),"君"===e.slice(-1)&&(e=e.substr(0,-1).replace("　"," "),n=1),""!==e&&(a[e]||(a[e]=0),a[e]+=1)});let n={};for(let t in a){const e=a[t];e>=5&&(n[t]=e)}e(t(n,"summary-chart-submitter"))})(),(()=>{let t={};n.map(e=>{e.map(e=>{t[e]=[0,0]})}),data.gian_summary.map(e=>{e[7].map(e=>{""!=e[15]&&[e[15],e[16]].map((e,a)=>{(e=(e=(e=e.replaceAll("; ","／")).replaceAll(";","／")).replaceAll("・","／")).split("／").map(e=>{e in t&&(t[e][a]+=1)})})})});let a=Object.keys(t).map(e=>({key:e,for:t[e][0],agn:t[e][1]}));a.sort((t,e)=>t.for+t.agn-(e.for+e.agn)),t=Object.assign({},...a.map(t=>({[t.key]:[t.for,t.agn]}))),config_data=[[],[]],config_labels=[];for(let e in t)config_data[0].push(t[e][0]),config_data[1].push(t[e][1]),config_labels.push(e);e({domid:"summary-chart-foragainst",labels:config_labels,datasets:[{name:"賛成",data:config_data[0]},{name:"反対",data:config_data[1]}]})})(),(()=>{const t=Math.min(a.length,6);let e=a.map(t=>t);for(let n=0;n<t;n++){const t=Math.floor(Math.random()*(a.length-n));$("#keywords").append('<a href="">'+e[t]+"</a>｜"),e.splice(t,1)}$("#keywords").find("a").on("click",function(t){t.preventDefault(),$("#input-gian-title").val($(this).text()),$("#form-gian-search").submit()})})(),$("#cover").fadeOut()},e=e=>{let a=0;const n=["updatetime","gian_type","gian_status","gian_summary"];n.map(e=>{$.getJSON("data/"+e+".json",function(i){data[e]=i,++a>=n.length&&t()})})};localStorage.getItem("smri-gian")?(data=localStorage.getItem("smri-gian"),$.getJSON("data/updatetime.json",function(a){new Date(a.file_update)>new Date(data.updatetime.file_update)?e():t()})):e()})(),(()=>{const a=(t,e)=>{const a=t=>{let e=t;return e=t.replace(/[\u3041-\u3096]/g,function(t){var e=t.charCodeAt(0)+96;return String.fromCharCode(e)}),e=e.replace(/[Ａ-Ｚａ-ｚ０-９]/g,function(t){return String.fromCharCode(t.charCodeAt(0)-65248)})};t=a(t),e=a(e),["　"," ",","].map(a=>{t=t.replace(a,"／／"),e=e.replace(a,"")});let n=!0;return t.split("／／").map(t=>{-1===e.indexOf(t)&&(n=!1)}),n},n=(t,e)=>{if(""==t)return!0;if(""==e)return!1;let a=!1;return-1!==(e=(e=(e=e.replaceAll("・","／")).replaceAll("; ","／")).replaceAll(";","／")).split("／").indexOf(t)&&(a=!0),a};$("#form-gian-search").on("submit",function(s){s.preventDefault(),$("#ul-gian-list").empty();let l=0,o=0,r=$("#select-gian-type").find("option:selected").text(),c=$("#select-gian-status").find("option:selected").text();"指定なし"===r&&(r=""),"指定なし"===c&&(c="");const d=$("#input-gian-title").val(),p=$("#input-gian-submitter").val(),m=$("#select-party-for").val(),u=$("#select-party-against").val();gResults=[];for(let t=0;t<data.gian_summary.length;t++){const e=data.gian_summary[t];let i=!0;if(i=a(d,e[3]),a(p,e[6])||(i=!1),-1===e[0].indexOf(r)&&(i=!1),-1===e[5].indexOf(c)&&(i=!1),e[7].map(t=>{n(m,t[15])||(i=!1),n(u,t[16])||(i=!1)}),i&&(l+=1,o+=e[7].length,gResults.push(e),l<=1e3)){const a='<li index="'+t+'"><div><span>第'+e[4]+"回国会</span> "+e[5]+"</div><div>"+e[3]+"</div><div>提出：第"+e[1]+"回国会｜"+e[0]+"</div></li>";$("#ul-gian-list").append(a)}}l>1e3?$("#result-number").text(i(l)+"件ヒットしました。"+i(1e3)+"件までを表示しています。"):0===l?$("#result-number").text("該当する議案がありませんでした。"):$("#result-number").text(i(l)+"件ヒットしました。"),0===l?$("#download-result").text(""):$("#download-result").text("検索結果（途中経過含め"+o+"件）をCSVでダウンロードする"),$("li").on("click",function(){(a=>{const n=$("#single-gian-content-inner"),i=$("#single-gian-content-keika").empty(),s=data.gian_summary[parseInt(a)];n.find("h3").text(s[3]),$("#ul-single-gian-items").empty(),[0,1,2,4,5,6].map(e=>{const a="<li><div>"+t[e]+"</div><div>"+s[e]+"</div></li>";$("#ul-single-gian-items").append(a)}),s[7].map(t=>{i.append("<h4>第"+t[0]+"回の経過情報</h4>"),i.append('<ul class="keika"></ul>'),$ul=i.find("ul.keika:last");for(let a=1;a<t.length;a++){let n=t[a];if(2===a||4===a){const e=t[a+1];"https://"===e.slice(0,8)&&(n='<a href="'+e+'" target="_blank">'+n+"へのリンク</a>")}else if(3===a||5===a)continue;const i="<li><div>"+e[a]+"</div><div>"+n+"</div></li>";$ul.append(i)}}),$("body").addClass("single-gian-show")})($(this).attr("index"))})}),$("#single-gian-cover").on("click",function(){$("body").removeClass("single-gian-show")}),$("#single-gian-button-close").on("click",function(){$("body").removeClass("single-gian-show")}),$("#switch").find(".switch-item").on("click",function(){$(this).hasClass("selected")||($(this).siblings(".switch-item").removeClass("selected"),$(this).addClass("selected"),$("#switch").find(".switch-item").each(function(){let t=$(this).attr("code");$(this).hasClass("selected")?$("#"+t+"-block").addClass("show"):$("#"+t+"-block").removeClass("show"),$("body, html").scrollTop(0)}))}),$("#download-result").on("click",function(a){a.preventDefault();const n=new Date,i=n.getFullYear(),s=n.getMonth()+1,l=n.getDate(),o=n.getHours(),r=n.getMinutes(),c=n.getSeconds(),d=(()=>{let a=t.concat(e);a.splice(4,2);let n=a.join(",")+"\n";return gResults.map(t=>{t[7].map((e,a)=>{n+=[t[0],t[1],t[2],t[3],t[6]].join(",")+","+e.join(",")+"\n"})}),n})(),p="smri-national-diet-bills-"+i+s+l+o+r+c+".csv",m=new Uint8Array([239,187,191]),u=new Blob([m,d],{type:"text/csv"});if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(u,p);else{const t=(window.URL||window.webkitURL).createObjectURL(u),e=document.createElement("a");e.href=t,e.download=p,e.click(),(window.URL||window.webkitURL).revokeObjectURL(t)}}),$("#social-button-copy").on("click",function(t){t.preventDefault();let e=$("<textarea></textarea>");e.text("国会議案データベース - スマートニュース メディア研究所\nhttps://smartnews-smri.github.io/national-diet-bills/"),$(this).append(e),e.select(),document.execCommand("copy"),e.remove();let a=$(this).next(".text-copy");a.addClass("copied"),setTimeout(function(){a.removeClass("copied")},3e3)})})()};$(function(){init()});